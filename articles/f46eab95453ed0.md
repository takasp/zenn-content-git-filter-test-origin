---
title: "actions/github-script ã‚’ä½¿ã£ã¦ Pull Request ã®ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼ã«è‡ªå‹•ã‚¢ã‚µã‚¤ãƒ³ã™ã‚‹"
emoji: "ğŸ¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["github", "githubactions"]
published: false
---

# ã¯ã˜ã‚ã«

Pull Request ã‚’ä½œæˆã™ã‚‹ãŸã³ã«æ‰‹å‹•ã§ä»»æ„ã®ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼ã‚’ã‚¢ã‚µã‚¤ãƒ³ã™ã‚‹ã®ã¯é¢å€’ã§ã™ã€‚
ã§ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚ªãƒ¼ãƒŠãƒ¼ã‚’æŒ‡å®šã—ã¦å¸¸ã«ä¸€å®šã®äººã‚’ã‚¢ã‚µã‚¤ãƒ³ã™ã‚Œã°è‰¯ã„ã‹ã¨ã„ã†ã¨ã€ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼å…¨å“¡ã‚’ã‚¢ã‚µã‚¤ãƒ³ã™ã‚‹ã“ã¨ã«ãªã£ãŸã‚Šã€ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼ãŒå›ºå®šåŒ–ã•ã‚Œã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
ã¨ã„ã†ã“ã¨ã§ã€Pull Request ä½œæˆæ™‚ã«ã€ç‰¹å®šã®ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ä¸€äººã¥ã¤ãƒ©ãƒ³ãƒ€ãƒ ã«è‡ªå‹•ã§ã‚¢ã‚µã‚¤ãƒ³ã™ã‚‹ GitHub Actions ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚

# actions/github-script ã¨ã¯

[actions/github-script](https://github.com/actions/github-script) ã¯ GitHub API ã®å‘¼ã³å‡ºã—ã‚’ JavaScript ã§æ›¸ã‘ã‚‹å…¬å¼ã® Action ã§ã™ã€‚
ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã® Action ã‚’ä½¿ã„ãŸããªã„ã¨ã„ã†æ™‚ã‚„ GitHub ã®ã¡ã‚‡ã£ã¨ã—ãŸæ“ä½œã‚’ç°¡å˜ã«è¡Œã„ãŸã„ã¨ã„ã£ãŸå ´åˆã«æœ‰ç”¨ã§ã™ã€‚
å®Ÿæ…‹ã®å‡¦ç†ã¯ [octokit/rest.js](https://octokit.github.io/rest.js/) ã§è¡Œã‚ã‚Œã¦ã„ã‚‹ã®ã§ã€æ“ä½œã™ã‚‹æ™‚ã¯ã“ã¡ã‚‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã™ã‚‹ã¨ä½¿ã„æ–¹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚

# GitHub Actions ã®å®Ÿè£…

GitHub Actions ã®å®Ÿè£…ã¯ã“ã¡ã‚‰ã§ã™ã€‚
assignees ã«ã¯ Pull Request ã®ä½œæˆè€…ã‚’ã‚¢ã‚µã‚¤ãƒ³ã€
reviewers ã«ã¯ã‚°ãƒ«ãƒ¼ãƒ—ã¨ãƒ¡ãƒ³ãƒãƒ¼ã‚’å®šç¾©ã—ã¦ã€ãã‚Œãã‚Œã®ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ä¸€äººãšã¤ãƒ©ãƒ³ãƒ€ãƒ ã«æŠ½å‡ºã—ã¦ã‚¢ã‚µã‚¤ãƒ³ã—ã¦ã„ã¾ã™ã€‚
ãã®æ™‚ã€reviewers ã«ã¯ Pull Request ã®ä½œæˆè€…ã¯ã‚¢ã‚µã‚¤ãƒ³ã§ããªã„ã®ã§é™¤ã„ã¦ã„ã¾ã™ã€‚

```yaml
name: Auto assign pull requests

on:
  pull_request:
    types: [opened]

permissions:
  pull-requests: write
  issues: read

jobs:
  assign:
    name: Assign assignees and reviewers
    runs-on: ubuntu-latest
    steps:
      - name: Assign Pull Request Author as Assignee
        uses: actions/github-script@v6
        if: ${{ toJSON(github.event.pull_request.assignees) == '[]' }} # Assignees ã‚’è¨­å®šã—ã¦ã„ãªã„æ™‚ã ã‘å‹•ã‹ã™
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { number, user } = context.payload.pull_request;
            await github.rest.issues.addAssignees({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: number,
              assignees: [user.login]
            });
      - name: Assign random reviewers
        uses: actions/github-script@v6
        if: ${{ toJSON(github.event.pull_request.requested_reviewers) == '[]' }} # Reviewers ã‚’è¨­å®šã—ã¦ã„ãªã„æ™‚ã ã‘å‹•ã‹ã™
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            // ä»»æ„ã®ã‚°ãƒ«ãƒ¼ãƒ—ã¨ãƒ¡ãƒ³ãƒãƒ¼ã‚’å®šç¾©
            const groups = {
              group1: ['user1', 'user2', 'user3'],
              group2: ['user4', 'user5', 'user6'],
              group3: ['user7', 'user8', 'user9']
            };

            const author = context.payload.pull_request.user.login;
            const reviewers = [];
            for (const [group, members] of Object.entries(groups)) {
              // Pull Request ä½œæˆè€…ã¯ã‚¢ã‚µã‚¤ãƒ³ã‹ã‚‰é™¤ã
              const filteredMembers = members.filter(user => user !== author);
              if (filteredMembers.length > 0) {
                const randomReviewer = filteredMembers[Math.floor(Math.random() * filteredMembers.length)];
                reviewers.push(randomReviewer);
              }
            }

            await github.rest.pulls.requestReviewers({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.payload.pull_request.number,
              reviewers
            });
```

# ã•ã„ã”ã«
`actions/github-script` ã¯ `octokit/rest.js` ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒåˆ†ã‹ã‚Šã‚„ã™ãã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒç´ ç›´ã«å‘¼ã¹ã‚‹ã®ã§ç›´æ„Ÿçš„ã«æ›¸ã‘ã‚‹å°è±¡ã§ã—ãŸã€‚
ä»Šå›ã¯å¯¾è±¡ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚„ãƒ¡ãƒ³ãƒãƒ¼ã‚’ JavaScript å†…ã§å®šç¾©ã—ã¾ã—ãŸãŒã€åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šå‡ºã—ãŸã‚Šã€CODEOWNERS ã‹ã‚‰å‚ç…§ã™ã‚‹ãªã©ãŒå¯èƒ½ã§ã™ã€‚

ã“ã®ç¨‹åº¦ã§ã‚ã‚Œã° shell ã§ã‚‚ãã®ã¾ã¾æ›¸ã‘ã¾ã™ãŒã€`actions/github-script` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§è¨˜è¿°ãŒçŸ­ãã€shell ãŒè‹¦æ‰‹ã§ã‚‚ JavaScript ãŒæ›¸ã‘ã‚Œã°æ”¹ä¿®ã§ãã¾ã™ã€‚
ã¾ãŸã€è¦ä»¶ãŒå¤‰ã‚ã£ãŸæ™‚ã€shell ã«æ¯”ã¹ã¦ãƒ­ã‚¸ãƒƒã‚¯ã‚‚ä¿®æ­£ã—ã‚„ã™ã„ã ã‚ã†ã¨åˆ¤æ–­ã—ã¦ä½¿ç”¨ã—ã¦ã¿ã¾ã—ãŸã€‚

# å‚è€ƒ

[GitHub Actions ã§ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è‡ªå‹•ã‚¢ã‚µã‚¤ãƒ³ã‚’ã™ã‚‹](https://qiita.com/hkusu/items/39eb92dbd4d6db8a14d8)
[PR ã® assignees ãŒç©ºã ã£ãŸã¨ãã«è‡ªå‹•ã‚¢ã‚µã‚¤ãƒ³](https://zenn.dev/snowcait/articles/d6bc5eafd8ab75)
[actions/github-script](https://github.com/actions/github-script)
